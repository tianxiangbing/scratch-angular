!function(a,b){"function"==typeof define&&define.amd?define(["$"],b):"object"==typeof exports?module.exports=b():a.CarouselImage=b(window.Zepto||window.jQuery||$)}(this,function(a){function b(){}return a.fn.CarouselImage=function(c){var d=[];return a(this).each(function(){var e=new b,f=a.extend({target:a(this)},c);e.init(f),d.push(e)}),d},b.prototype={init:function(a){if(this.settings=a,this.index=0,this.container=a.target,this.content=this.container.children().first(),this.timer=a.timer||3e3,this.animate=a.animate||300,this.num=a.num||null,this.list=this.content.children(),this.size=this.list.length,this.repeat=a.repeat||!1,this.step=this.container.width(),this.repeat){var b=this.list.first().clone(),c=this.list.last().clone();this.content.append(b),this.content.prepend(c),this.content.css({left:-this.container.width(),position:"absolute"}),this.content.width((this.list.length+2)*this.step)}else this.content.css({left:0,position:"absolute"}),this.content.width(this.list.length*this.step);this.setHeightWidth(),this.bindEvent(),this.auto(),this.formatNum()},setHeightWidth:function(){function b(b){var c=this.height,d=this.width,e=g.container;if(!g.settings.height){var f=g.container.width()/d*c;g.container.height(g.container.width()/d*c),g.container.find("a").height(f),g.content.css({position:"absolute"})}var h=g.container.width(),i=h/d*c;a(".carousel-"+b,e).height()>g.container.height()&&(a(".carousel-"+b,e).height(g.container.height()),a(".carousel-"+b,e).width(g.container.height()/c*d)),a(".carousel-"+b,e).width()>g.container.width()&&(a(".carousel-"+b,e).width(h),a(".carousel-"+b,e).height(i));var j=a(".carousel-"+b,e).width(),k=a(".carousel-"+b,e).height(),l=(g.container.height()-k)/2,m=(g.container.width()-j)/2;a(".carousel-"+b,e).css({left:m,top:l,position:"absolute"})}var c=this.settings;c.width&&this.container.width(c.width),c.height&&this.container.height(c.height),this.step=this.container.width(),c.repeat?this.content.width((this.list.length+2)*this.step):this.content.width(this.list.length*this.step);for(var d=0,e=this.content.children().length;e>d;d++){var f=a(this.content.children()[d]);f.find("img").addClass("carousel-"+d).attr("data-index",d)}var g=this;this.container.find("a").css({width:this.step,height:this.container.height(),position:"relative"}),this.container.find("img").each(function(){var c=new Image;c.src=a(this).attr("src");var d=a(this).data("index");!function(a,c){a.complete?b.call(a,c):(a.onreadystatechange=function(){"complete"!=this.readystate&&"loaded"!=this.readyState||b.call(this,c)},a.onload=function(){b.call(this,c)})}(c,d)})},touch:function(b,c,d){function e(a){return d.call(this,a)}var f;"function"==typeof c&&(d=c),a(b).on("touchmove",c,function(a){f=!0}).on("touchend",c,function(a){if(a.preventDefault(),!f){var b=d.call(this,a,"touch");b===!1&&(a.preventDefault(),a.stopPropagation())}f=!1}),a(b).on("click",c,e)},bindEvent:function(){var b=this,c={},d=0,e={},f=!1,g={};this.content.on("touchstart",function(e){var h=e.changedTouches||e.originalEvent.changedTouches;return c={x:h[0].pageX},2==h.length?(f=!1,!1):(g=a(this).position(),d=c.x,void b.stop())}).on("touchmove",function(d){var h=d.changedTouches||d.originalEvent.changedTouches;return 2==h.length?!1:(f=!0,e={x:h[0].pageX},b.bloom?(g={left:g.left+(e.x-c.x)},a(this).css(g)):(g.left=g.left+(e.x-c.x),a(this).css({left:g.left})),c=e,!1)}).on("touchend",function(g){var h=g.changedTouches||g.originalEvent.changedTouches;e={x:h[0].pageX};var i=a(this).position(),j={left:i.left+(e.x-c.x)};a(this).css(j),e.x>d+10?(b.index--,b.go()):e.x<d-10&&(b.index++,b.go()),f=!1,b.auto()}),b.touch(b.num,"i",function(){clearInterval(b.interval),b.index=a(this).index(),b.go(),b.auto()}),a(window).resize(function(){b.settings.width||(b.content.find("img").css({width:"auto",height:"auto"}),b.go(),b.setHeightWidth())})},formatNum:function(){if(this.num){for(var a="",b=0,c=this.list.length;c>b;b++){var d=(this.list[b],"");this.index==b&&(d="current"),a+='<i class="'+d+'">'+(b+1)+"</i>"}this.num.html(a)}},go:function(){var a=this,b=a.step;if(this.repeat){var c=-(a.index+1)*b;a.index<0&&(c=0),0==a.index&&(c=-b),a.content.animate({left:c},a.animate,function(){a.index<0&&(a.index=a.list.size()-1,a.content.css("left",-(a.index+1)*b)),a.index>=a.list.size()&&(a.index=0,a.content.css("left",-1*b)),a.formatNum()})}else{a.index<0&&(a.index=0),a.index>=a.size&&(a.index=a.size-1);var c=-a.index*b;a.content.animate({left:c},a.animate,function(){a.formatNum()})}},auto:function(){var a=this;this.interval&&a.stop(),this.interval=setInterval(function(){a.index++,a.repeat||a.index>=a.size&&(a.index=0),a.go()},this.timer)},stop:function(){clearInterval(this.interval),this.interval=null}},b});