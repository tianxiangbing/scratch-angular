function Lottery(a,b,c,d,e,f){this.conId=a,this.conNode=document.getElementById(this.conId),this.cover=b,this.coverType=c,this.background=null,this.backCtx=null,this.mask=null,this.maskCtx=null,this.lottery=null,this.lotteryType="image",this.width=d||300,this.height=e||100,this.clientRect=null,this.drawPercentCallback=f}Lottery.prototype={createElement:function(a,b){var c=document.createElement(a);for(var d in b)c.setAttribute(d,b[d]);return c},getTransparentPercent:function(a,b,c){for(var d=a.getImageData(0,0,b,c),e=d.data,f=[],g=0,h=e.length;h>g;g+=4){var i=e[g+3];128>i&&f.push(g)}return(f.length/(e.length/4)*100).toFixed(2)},resizeCanvas:function(a,b,c){a.width=b,a.height=c,a.getContext("2d").clearRect(0,0,b,c)},drawPoint:function(a,b){this.maskCtx.beginPath();var c=this.maskCtx.createRadialGradient(a,b,0,a,b,30);c.addColorStop(0,"rgba(0,0,0,0.6)"),c.addColorStop(1,"rgba(255, 255, 255, 0)"),this.maskCtx.fillStyle=c,this.maskCtx.arc(a,b,30,0,2*Math.PI,!0),this.maskCtx.fill(),this.drawPercentCallback&&this.drawPercentCallback.call(null,this.getTransparentPercent(this.maskCtx,this.width,this.height))},bindEvent:function(){var a=this,b=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),c=b?"touchstart":"mousedown",d=b?"touchmove":"mousemove";if(b)document.addEventListener("touchmove",function(a){e&&a.preventDefault()},!1),document.addEventListener("touchend",function(a){e=!1},!1);else{var e=!1;document.addEventListener("mouseup",function(a){e=!1},!1)}this.mask.addEventListener(c,function(c){e=!0;document.documentElement;a.clientRect||(a.clientRect=$(a.mask).offset());var d=(b?c.touches[0].pageX:c.pageX)-a.clientRect.left,f=(b?c.touches[0].pageY:c.pageY)-a.clientRect.top;a.drawPoint(d,f)},!1),this.mask.addEventListener(d,function(c){if(!b&&!e)return!1;document.body||document.documentElement;a.clientRect||(a.clientRect=$(a.mask).offset());var d=(b?c.touches[0].pageX:c.pageX)-a.clientRect.left,f=(b?c.touches[0].pageY:c.pageY)-a.clientRect.top;a.drawPoint(d,f)},!1)},drawLottery:function(a){if(0==a.length?this.text="":this.text=a,this.background=this.background||this.createElement("canvas",{style:"position:absolute;left:0;top:0;"}),this.mask=this.mask||this.createElement("canvas",{style:"position:absolute;left:0;top:0;"}),this.conNode.innerHTML.replace(/[\w\W]| /g,"")||(this.conNode.appendChild(this.background),this.conNode.appendChild(this.mask),this.bindEvent()),this.backCtx=this.backCtx||this.background.getContext("2d"),this.maskCtx=this.maskCtx||this.mask.getContext("2d"),"image"==this.lotteryType){var b=new Image,c=this;b.onload=function(){c.width=this.width,c.height=this.height,c.resizeCanvas(c.background,this.width,this.height),c.backCtx.drawImage(this,0,0),c.drawMask()},b.src=this.lottery}else if("text"==this.lotteryType){this.width=this.width,this.height=this.height,this.resizeCanvas(this.background,this.width,this.height),this.backCtx.save(),this.backCtx.fillStyle="#FFF",this.backCtx.fillRect(0,0,this.width,this.height),this.backCtx.restore(),this.backCtx.save();var d=this.height/3;this.backCtx.font="Bold "+d+"px Arial",this.backCtx.textAlign="center",this.backCtx.fillStyle="#F60",this.backCtx.fillText(this.text,this.width/2,this.height/2+d/2),this.backCtx.restore()}},drawMask:function(){if(this.resizeCanvas(this.mask,this.width,this.height),"color"==this.coverType){this.maskCtx.fillStyle=this.cover,this.maskCtx.fillRect(0,0,this.width,this.height);var a=30;this.maskCtx.font="Bolder "+a+"px Arial",this.maskCtx.textAlign="center",this.maskCtx.fillStyle="#686868",this.maskCtx.fillText(this.maskText,this.width/2,this.height/2+a/2),this.maskCtx.restore(),this.maskCtx.globalCompositeOperation="destination-out"}else if("image"==this.coverType){var b=new Image,c=this;b.onload=function(){c.maskCtx.drawImage(this,0,0),c.maskCtx.globalCompositeOperation="destination-out"},b.src=this.cover}},init:function(a,b){this.lottery=a,this.lotteryType=b||"image",this.drawLottery(""),this.drawMask()}};