"use strict";var directives=angular.module("myApp.directives",["myApp.services"]);directives.directive("lottery",function(a){return{restrict:"EA",replace:!0,templateUrl:"template/lottery.html",link:function(b,c,d){function e(c){c>10&&!h?(h=!0,b.lotteryNumber>0?(k=!0,a.lottery().then(function(a){g.drawLottery(a.msg),v.forEach(function(b,c){b.level==a.data&&(j=b.index)}),b.lotteryNumber>0&&b.lotteryNumber--})):(k=!1,g.drawLottery("您没有刮刮卡了."))):c>50&&!i&&k&&(i=!0,f(j))}function f(a){w.show(),$(".message-box").prop("class","message-box index-"+a),a>4&&$(".message-box").find(".action").prop("class","action action-single")}var g=new Lottery("lotteryContainer","#bfbfbf","color",$(c).width(),$(c).height(),e);g.maskText="刮开此图层",g.init(g,"text");var h=!1,i=!1,j=0,k=!1,l=1,m=2,n=3,o=4,p=5,q=6,r=7,s=8,t=9,u=10,v=[{level:l,index:1},{level:m,index:2},{level:n,index:3},{level:o,index:4},{level:p,index:5},{level:q,index:6},{level:r,index:7},{level:s,index:8},{level:t,index:9},{level:u,index:10}],w=new Dialog;w.init({target:$(".message-box"),show:!1,fixed:!0,mask:!0,afterHide:function(){g.drawLottery(""),g.drawMask(),h=!1,i=!1}})}}}),directives.directive("lotteryCount",function(){return{restrict:"EA",replace:!0,templateUrl:"template/lottery-count.html",scope:{count:"=counter"},link:function(a,b,c){}}}),directives.directive("goodsList",function(a){return{restrict:"EA",replace:!0,templateUrl:"template/goods-list.html",link:function(b,c,d){a.getList(b.uid).then(function(a){if(a.status){var d=a.data,e=angular.element(c.children(".goods-list").children());console.log(e),d.a>0&&e.eq(0).find("i").addClass("active").html(d.a),d.b>0&&e.eq(1).find("i").addClass("active").html(d.b),d.c>0&&e.eq(2).find("i").addClass("active").html(d.c),d.d>0&&e.eq(3).find("i").addClass("active").html(d.d),b.e=d.e,e.eq(4).bind("click",function(){var a=new Dialog;a.init({target:$(".msg-1"),show:!0,fixed:!0,mask:!0})})}else alert(a.msg)})}}}),directives.directive("rule",function(){return{restrict:"EA",replace:!0,templateUrl:"template/rule.html",link:function(a,b,c){}}}),directives.directive("onFinish",function(a){return{restrict:"A",link:function(b,c,d){b.$last===!0&&a(function(){b.$emit("ngFinish")})}}}),directives.directive("goodsPreview",function(a){return{restrict:"EA",replace:!0,templateUrl:"template/goods-preview.html",link:function(b,c,d){a.getGoodsList().then(function(a){a.status&&(b.goodsList=a.data,b.$on("ngFinish",function(){var a=new CarouselImage;a.init({target:$(".carousel-image"),num:$(".carousel-num")})}))})}}});